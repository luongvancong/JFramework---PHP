var hostname=location.hostname;var domain_allows=["localhost","sea.taobao.com","item.taobao.com","tmall.com","detail.tmall.com"];var type_pick=1;if(domain_allows.indexOf(hostname)<0){type_pick=0;}console.log(type_pick);Element.prototype.remove=function(){this.parentElement.removeChild(this);};NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var b=0,a=this.length;b<a;b++){if(this[b]&&this[b].parentElement){this[b].parentElement.removeChild(this[b]);}}};var workspace={};workspace.tools={};workspace.tools.Base64={};workspace.tools.Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=workspace.tools.Base64._utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64;}else{if(isNaN(f)){d=64;}}a=a+this._keyStr.charAt(j)+this._keyStr.charAt(g)+this._keyStr.charAt(e)+this._keyStr.charAt(d);}return a;},decode:function(c){var a="";var k,h,f;var j,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){j=this._keyStr.indexOf(c.charAt(b++));g=this._keyStr.indexOf(c.charAt(b++));e=this._keyStr.indexOf(c.charAt(b++));d=this._keyStr.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h);}if(d!=64){a=a+String.fromCharCode(f);}}a=workspace.tools.Base64._utf8_decode(a);return a;},_utf8_encode:function(b){b=b.replace(/\r\n/g,"\n");var a="";for(var e=0;e<b.length;e++){var d=b.charCodeAt(e);if(d<128){a+=String.fromCharCode(d);}else{if((d>127)&&(d<2048)){a+=String.fromCharCode((d>>6)|192);a+=String.fromCharCode((d&63)|128);}else{a+=String.fromCharCode((d>>12)|224);a+=String.fromCharCode(((d>>6)&63)|128);a+=String.fromCharCode((d&63)|128);}}}return a;},_utf8_decode:function(a){var b="";var e=0;var g=0,f=0,d=0;while(e<a.length){g=a.charCodeAt(e);if(g<128){b+=String.fromCharCode(g);e++;}else{if((g>191)&&(g<224)){d=a.charCodeAt(e+1);b+=String.fromCharCode(((g&31)<<6)|(d&63));e+=2;}else{d=a.charCodeAt(e+1);c3=a.charCodeAt(e+2);b+=String.fromCharCode(((g&15)<<12)|((d&63)<<6)|(c3&63));e+=3;}}}return b;}};var DEVELOPMENT=1;if(DEVELOPMENT!=1){var url_get_images="http://flypaper.vn/account/products/add";var url_loading_gif="http://flypaper.vn/assets/img/loading.gif";}else{var url_get_images="http://localhost:12346/account/products/add";var url_loading_gif="http://localhost:12346/assets/img/loading.gif";}var body=document.getElementsByTagName("body")[0];body.style.overflow="hidden";var tmall_site_nav=document.getElementById("site-nav");var detail_taobao=document.getElementById("detail");if(tmall_site_nav&&hostname=="detail.tmall.com"){tmall_site_nav.style.zIndex=99;}if(detail_taobao&&hostname=="item.taobao.com"){detail_taobao.style.zIndex=99;document.getElementById("J_SiteNav").style.zIndex=99;}function openWindow(a){window.open(a,"_blank");window.focus();}workspace.pickImages={findImagesInPage:function(){var a=document.images;
return a;},closeBackdrop:function(){body.style.overflow="initial";var a=document.getElementById("clv-container-bg");if(a){a.remove();}this.closeModal();},closeModal:function(){var a=document.getElementById("c-modal-bound");if(a){a.style.display="none";}},onChooseImage:function(e){var f=0;var h="";if(hostname=="detail.tmall.com"){if(document.querySelector("#J_PromoPrice .tm-price")){var f=document.querySelector("#J_PromoPrice .tm-price").innerHTML;}var c=document.getElementById("description");if(c){var g=document.querySelector("#description img");h=c;}}else{if(hostname=="item.taobao.com"){var i=document.querySelector("#J_PromoPrice .tb-rmb");if(i){i.remove();}var b=document.querySelector("#J_PromoPrice .tb-rmb-num");if(b&&b.innerHTML){f=b.innerHTML;}else{if(document.querySelector("#J_PromoPrice .tm-price")){f=document.querySelector("#J_PromoPrice .tm-price").innerHTML;}else{if(document.querySelector("#J_StrPrice .tb-rmb-num")){f=document.querySelector("#J_StrPrice .tb-rmb-num").innerHTML;}}}}}var a=getImagesDescription(document.getElementById("description"));var d={picture:e.getAttribute("data-picture"),price:f,description:JSON.stringify(a),source:window.location.href};var j="?data="+workspace.tools.Base64.encode(JSON.stringify(d))+"&add_type=crawler";openWindow(url_get_images+j);},modal:function(a){},getHtmlModalLoading:function(){var f=document.createElement("div");var a=document.createElement("div");var c=document.createElement("div");var g=document.createElement("div");var e=document.createElement("div");var d=document.createElement("div");var b=document.createElement("div");a.setAttribute("id","c-modal-container");a.style.width="400px";a.style.background="#fff";a.style.position="fixed";a.style.left="35%";a.style.top="19%";a.style.zIndex="10000000000";a.style.boxShadow="0 0 5px rgba(0,0,0,4)";g.style.padding="10px";c.setAttribute("id","c-modal-header");c.style.borderBottom="1px solid #ccc";c.style.padding="8px";c.style.fontWeight="bold";c.innerHTML="Thông báo";e.setAttribute("id","c-modal-wrapper");g.setAttribute("id","c-modal-body");g.innerHTML='Bạn vui lòng đợi cho đến khi trang web được tải xong. <img style="position: relative;top: 4px;" src="'+url_loading_gif+'" />';b.style.overflow="hidden";d.style.border="1px solid #ccc";d.style.textAlign="center";d.style.background="rgb(235, 28, 28)";d.style.color="#fff";d.style.cssFloat="right";d.style.padding="5px 15px";d.style.margin="0px 5px 5px 0";d.style.border="none";d.style.cursor="pointer";d.setAttribute("onclick",'javascript:document.getElementById("c-modal-container").remove()');d.innerHTML="Đóng";e.appendChild(c);e.appendChild(g);e.appendChild(d);a.appendChild(e);f.appendChild(a);return f.innerHTML;},getHtmlBackdrop:function(){var a=document.createElement("div");var b=document.createElement("div");b.setAttribute("id","clv-backdrop");b.style.height="100%";b.style.width="100%";b.style.position="fixed";b.style.top="0";b.style.background="rgba(0,0,0, .7)";b.style.zIndex="999999999";b.style.overflow="auto";
a.appendChild(b);return a.innerHTML;},showBackdrop:function(){var a=document.getElementById("clv-backdrop-container");if(!a){a=document.createElement("div");a.setAttribute("id","clv-backdrop-container");body.appendChild(a);}this._backdrop_element=a;a.innerHTML=this.getHtmlBackdrop();},hideBackrop:function(){if(this._backdrop_element){this._backdrop_element.remove();}},init:function(){var e=document.createElement("div");e.setAttribute("id","clv-container-bg");body.appendChild(e);var b=document.createElement("div");b.setAttribute("id","clv-wrapper");b.style.height="100%";b.style.width="100%";b.style.position="fixed";b.style.top="0";b.style.background="rgba(0,0,0, .7)";b.style.zIndex="999999999";b.style.overflow="auto";e.appendChild(b);var h=document.createElement("div");h.setAttribute("class","clv-btn-close");h.setAttribute("onclick","workspace.pickImages.closeBackdrop()");h.innerHTML="Thoát";h.style.padding="5px 10px";h.style.background="#fff";h.style.color="red";h.style.position="fixed";h.style.right="25px";h.style.top="30px";h.style.cursor="pointer";b.appendChild(h);var j=document.createElement("div");j.setAttribute("class","clv-list-images");j.style.width="1170px";j.style.margin="0px auto";j.style.overflow="hidden";b.appendChild(j);var f=this.findImagesInPage();for(var d in f){var c=new Image();c.src=f[d].src;if(c.width>=300){var g=document.createElement("div");g.setAttribute("class","clv-div-crop-img");g.style.cssFloat="left";g.style.width="220px";g.style.height="200px";g.style.margin="5px";g.style.overflow="hidden";g.style.position="relative";g.style.background="#fff";var k=document.createElement("img");k.setAttribute("src",f[d].getAttribute("src"));g.appendChild(k);if(c.height<200){f[d].style.position="absolute";f[d].style.top="25%";}f[d].style.width="100%";var a=document.createElement("div");a.setAttribute("class","clv-pick-picture");a.setAttribute("onclick","workspace.pickImages.onChooseImage(this)");a.setAttribute("data-picture",f[d].getAttribute("src"));a.innerHTML="Chọn";a.style.position="absolute";a.style.top="40%";a.style.left="42%";a.style.background="#fff";a.style.color="red";a.style.fontWeight="bold";a.style.borderRadius="3px";a.style.padding="5px 10px";a.style.cursor="pointer";a.style.border="1px solid #ccc";g.appendChild(a);document.getElementsByClassName("clv-list-images")[0].appendChild(g);}}}};function callAjax(b){var e="POST";var d=b.params;var a=b.url;var c=new XMLHttpRequest();c.open(e,a,true);c.send(d);}function is_object(b){return typeof b=="object"?true:false;}function getImagesDescription(c){var a=c;var d=[];var f=[];if(a){if(hostname=="item.taobao.com"){f=a.querySelectorAll("p img");}else{if(hostname=="detail.tmall.com"){f=a.querySelectorAll("img");}}console.log(a.querySelectorAll("img"));for(var b in f){if(b==40){break;}if(is_object(f[b])){if(f[b].hasAttribute("data-ks-lazyload")){f[b].setAttribute("src",f[b].getAttribute("data-ks-lazyload"));}var e=f[b].src;d.push(e);}}}return d;}function makeImageCanvas(e,a,g){var f=document.getElementById("c-canvas");
var b=f.getContext("2d");var d=document.getElementById("scream");b.drawImage(d,10,10);}if(domain_allows.indexOf(hostname)>=0){workspace.pickImages.hideBackrop();workspace.pickImages.init();workspace.pickImages.closeBackdrop();workspace.pickImages.init();workspace.pickImages.closeBackdrop();workspace.pickImages.init();}else{workspace.pickImages.init();}